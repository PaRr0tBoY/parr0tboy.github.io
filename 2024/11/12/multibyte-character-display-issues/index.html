<!doctype html><html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta><title>SQL Server Practice: Multibyte Characters Displayed With Incorrect Encoding - No Life Ryan</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#0E1225"><meta name="application-name" content="No Life Ryan"><meta name="msapplication-TileImage" content="img\apple-touch-icon.png"><meta name="msapplication-TileColor" content="#0E1225"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="No Life Ryan"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="180x180" href="img\apple-touch-icon.png"><meta name="description" content="Insight of why all multibyte character is printed as ‘?’"><meta property="og:type" content="blog"><meta property="og:title" content="SQL Server Practice: Multibyte Characters Displayed With Incorrect Encoding"><meta property="og:url" content="https://www.ac1d.space/2024/11/12/multibyte-character-display-issues/"><meta property="og:site_name" content="No Life Ryan"><meta property="og:description" content="Insight of why all multibyte character is printed as ‘?’"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.ac1d.space/img/202411121638633.png"><meta property="og:image" content="https://www.ac1d.space/img/202411121602100.png"><meta property="og:image" content="https://www.ac1d.space/img/202411121732298.png"><meta property="og:image" content="https://www.ac1d.space/img/29113.png"><meta property="og:image" content="https://www.ac1d.space/img/86674.png"><meta property="article:published_time" content="2024-11-12T07:58:29.000Z"><meta property="article:modified_time" content="2024-11-28T09:45:15.778Z"><meta property="article:author" content="Acid"><meta property="article:tag" content="数据库"><meta property="article:tag" content="微软"><meta property="article:tag" content="编码"><meta property="article:tag" content="debug"><meta property="article:tag" content="笔记"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://www.ac1d.space/img/202411121638633.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.ac1d.space/2024/11/12/multibyte-character-display-issues/"},"headline":"SQL Server Practice: Multibyte Characters Displayed With Incorrect Encoding","image":["https://www.ac1d.space/img/202411121638633.png","https://www.ac1d.space/img/202411121602100.png","https://www.ac1d.space/img/202411121732298.png","https://www.ac1d.space/img/29113.png","https://www.ac1d.space/img/86674.png"],"datePublished":"2024-11-12T07:58:29.000Z","dateModified":"2024-11-28T09:45:15.778Z","author":{"@type":"Person","name":"Acid"},"publisher":{"@type":"Organization","name":"No Life Ryan","logo":{"@type":"ImageObject","url":{"text":"No Life Ryan"}}},"description":"Insight of why all multibyte character is printed as ‘?’"}</script><link rel="canonical" href="https://www.ac1d.space/2024/11/12/multibyte-character-display-issues/"><link rel="icon" href="/img/favicon-32x32.png"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.5.2/css/all.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="/css/custom-fonts.css"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><script>!function(){function e(){var e,t,a;location.hash&&(e="#"+CSS.escape(location.hash.substring(1)),t=document.querySelector(`.tabs a[href="${e}"]`))&&(a=t.parentElement.parentElement,Array.from(a.children).forEach(e=>e.classList.remove("is-active")),Array.from(a.querySelectorAll("a")).map(e=>document.getElementById(e.getAttribute("href").substring(1))).forEach(e=>e.classList.add("is-hidden")),t&&t.parentElement.classList.add("is-active"),a=document.querySelector(e))&&a.classList.remove("is-hidden")}e(),window.addEventListener("hashchange",e,!1)}()</script><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="No Life Ryan" type="application/atom+xml"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-menu"><a class="navbar-item navbar-logo" href="/">No Life Ryan</a><div class="navbar-start"><a class="navbar-item" href="/blog/">文章</a><a class="navbar-item" href="/myanimelist/">番剧清单</a><a class="navbar-item" href="/changelog/">变更日志</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fa-solid fa-circle-half-stroke" id="night-icon"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="INDEX" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-9-desktop is-9-widescreen"><div class="controller"></div><div class="card"><article class="card-content article" role="article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">SQL Server Practice: Multibyte Characters Displayed With Incorrect Encoding</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="far fa-calendar-alt"> </i><time datetime="${date_xml(page.date)}" title="${date_xml(page.date)}">2024-11-12</time></span><span class="level-item is-hidden-mobile"><i class="far fa-calendar-check"> </i><time datetime="${date_xml(page.updated)}" title="${date_xml(page.updated)}">2024-11-28</time></span><span class="level-item"><a class="link-muted" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span><span class="level-item">6 分钟读完 (约918个字)</span></div></div><div class="content"><p>Insight of why all multibyte character is printed as ‘?’</p><span id="more"></span><h2 id="the-issues"><a class="markdownIt-Anchor" href="#the-issues"></a> The Issues</h2><p>So in this semester.I took a database course and we use sql server as learning materials which is a headache for me.Since I use mac as my main working pc while Microsoft developed the sql server so it’s natural that sql server is not compatible for mac. To install it on my Mac, I have to borrow the power of virtual machine. After careful consideration of convenience and performance issues, I decided to use containers to install it. As an alternative to Docker, I chose Orbstack. It gave me a native Mac vibe while being free (for personal use). With simplicity and high performance, Orbstack is my best choice and imho the best option for any mac user with container requirements (I’m not their salesman tho).<br>I have previously written a step by step guide on how to install sql server on mac with container. Check that article if needed. The main topic of this article came to me when I was dealing with the professor’s assignment. When I tried to select a few rows from a given table, it turned out that all the Chinese characters were displayed as question marks, which is quite tricky since in this case I cannot get the correct result set when Chinese characters are contained in the WHERE clause. All Chinese characters are recognised as ‘?’ by the DBMS, so the WHERE clause has lost all meaning.</p><p><img src="/img/plazyload.webp" data-original="https://www.ac1d.space/img/202411121638633.png" alt="Chinese was not correctly encoded in the new query page."></p><p><img src="/img/plazyload.webp" data-original="https://www.ac1d.space/img/202411121602100.png" alt="Chinese was not correctly encoded in the result set."></p><h2 id="the-analyze"><a class="markdownIt-Anchor" href="#the-analyze"></a> The Analyze</h2><p>It occurs to me that ‘?’ means the DBMS used the wrong decoding for Chinese characters, which is why all Chinese characters are displayed as ‘?’, because the DBMS couldn’t find the correct symbol to display the Chinese character. So the actual problem is how to tell the DBMS to use the correct decoding. I tried to look this up in the settings with the keyword ‘encoding’ and found the following setting picture below. After changing it to Simplified Chinese (GB18030), I restarted Azure Data Studio and found that this fixed the display of Chinese characters in the new query page. However, the Chinese characters in the result set are still a mess.</p><p><img src="/img/plazyload.webp" data-original="https://www.ac1d.space/img/202411121732298.png" alt="The encoding setting"></p><h2 id="the-research"><a class="markdownIt-Anchor" href="#the-research"></a> The Research</h2><p>Later, after looking at the <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/sql/t-sql/data-types/nchar-and-nvarchar-transact-sql?view=sql-server-ver16">Official Sql Server Website</a>, I found this very useful information.</p><blockquote><p>Prefix a Unicode character string constants with the letter N to signal UCS-2 or UTF-16 input, depending on whether an SC collation is used or not. Without the N prefix, the string is converted to the default code page of the database that might not recognize certain characters.</p></blockquote><p>So I have two options: Either replace all char/varchar to nchar/nvarchar or use an SC (Supplementary Characters) collation. I decided to try the former first.</p><p>I drop the database with the code snippets below. To avoid crashes and accidental data corruption, we should set the database to single user mode and drop it. Also note that all connections to the database to be dropped should be disconnected before running the following code.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE database_name <span class="keyword">SET</span> SINGLE_USER <span class="keyword">WITH</span> <span class="keyword">ROLLBACK</span> IMMEDIATE; <span class="comment">--Set Single User mode</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> DATABASE database_name <span class="comment">--Drop Database with database name</span></span><br></pre></td></tr></table></figure><p><img src="/img/plazyload.webp" data-original="https://www.ac1d.space/img/29113.png" alt="The execution result"></p><p>After running the above code, make sure that <code>database_name</code> is actually dropped. Then recreate the database and tables to see if Chinese characters (or other multi-byte characters) are displayed correctly.</p><p>Turns out mine works fine.</p><p><img src="/img/plazyload.webp" data-original="https://www.ac1d.space/img/86674.png" alt="The correct version of select result"></p><p>There is another way: Set the SC collation. After looking through <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/sql/relational-databases/collations/collation-and-unicode-support?view=sql-server-ver16">Collation and unicode support</a>, I got this <code>Chinese_PRC_CI_AS</code>. So I dropped and recreated the database with the code below and recreated all the tables, multi-byte characters (Chinese) displayed correctly again.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE database_name <span class="comment">--Create Database &#x27;database_name&#x27;</span></span><br><span class="line"><span class="keyword">COLLATE</span> Chinese_PRC_CI_AS; <span class="comment">--Enable Chinese_PRC_CI_AS Collation for database</span></span><br></pre></td></tr></table></figure><p>After all, this is just another encoding problem. It’s possible that if we don’t explicitly enable SC collation, the string will fall back to the default codepage, which may not recognise certain multibyte characters. These characters are outside the range of datatypes stored under non-SC collation, so we might need to explicitly enable SC collation or use the N prefix to signal UCS-2 or UTF-16 input.</p><h2 id="references"><a class="markdownIt-Anchor" href="#references"></a> References</h2><p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/sql/relational-databases/collations/collation-and-unicode-support?view=sql-server-ver16">collation-and-unicodode</a></p><p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/sql/t-sql/data-types/nchar-and-nvarchar-transact-sql?view=sql-server-ver16">nchar-and-nvarchar-transact-sql</a></p><p><a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/rds/apsaradb-rds-for-sql-server/resolve-garbled-characters-in-tables-of-sql-server-databases">resolve-garbled-characters-in-tables-of-sql-server-databases</a></p><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/listjiang/p/16504594.html">解决 SqlServer中文乱码问题</a></p><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/144283/what-is-the-difference-between-varchar-and-nvarchar">what-is-the-difference-between-varchar-and-nvarchar</a></p></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"></div><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i> <a class="link-muted" rel="tag" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库, </a><a class="link-muted" rel="tag" href="/tags/%E5%BE%AE%E8%BD%AF/">微软, </a><a class="link-muted" rel="tag" href="/tags/%E7%BC%96%E7%A0%81/">编码, </a><a class="link-muted" rel="tag" href="/tags/debug/">debug, </a><a class="link-muted" rel="tag" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a></div></article></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2025/08/04/null/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Compiled Input-Leap: A Tool for Sharing Mouse and Keyboard Between MacOS and Windows(Took Me Whole Morning)</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2024/10/15/null/"><span class="level-item">Install-Sql-Server-on-Mac-With-Container</span><i class="level-item fas fa-chevron-right"></i></a></div></nav></div><div class="column column-right is-4-tablet is-3-desktop is-3-widescreen order-3"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">INDEX</h3><ul class="menu-list"><li><a class="level is-mobile" href="#the-issues"><span class="level-left"><span class="level-item">1</span><span class="level-item"> The Issues</span></span></a></li><li><a class="level is-mobile" href="#the-analyze"><span class="level-left"><span class="level-item">2</span><span class="level-item"> The Analyze</span></span></a></li><li><a class="level is-mobile" href="#the-research"><span class="level-left"><span class="level-item">3</span><span class="level-item"> The Research</span></span></a></li><li><a class="level is-mobile" href="#references"><span class="level-left"><span class="level-item">4</span><span class="level-item"> References</span></span></a></li></ul></div></div><style>#toc .menu-list>li>a.is-active+.menu-list{display:block}#toc .menu-list>li>a+.menu-list{display:none}</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">No Life Ryan</a><p class="is-size-7">本网站由<a class="footer-support-logo" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral" target="blank" title="又拍云"><img style="width:50px;height:25px;vertical-align:middle" border="0" src="/img/plazyload.webp" data-original="/img/upyun.png" alt="又拍云"></a>提供 CDN 加速/云存储服务 |<a href="https://uptimeflare-68h.pages.dev/" target="_blank">Blog Status</a><br><a class="footer-beian-logo" href="https://beian.mps.gov.cn/#/query/webSearch?code=44060602002738" target="blank" title="公网安备"><img style="width:15px;height:15px;vertical-align:middle" border="0" src="/img/plazyload.webp" data-original="/img/备案图标.png" alt="粤公网安备"></a><a href="https://beian.mps.gov.cn/#/query/webSearch?code=44060602002738" rel="noreferrer" target="_blank">粤公网安备44060602002738</a><a href="https://beian.miit.gov.cn/" target="_blank"> | 粤ICP备2024266018号-1</a><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("5/31/2024 18:23:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML=" | 已运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",250)</script></p><p class="is-size-7">All's I need is love.</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://www.bilibili.com"><i class="fab fa-bilibili"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/PaRr0tBoY"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("zh-cn")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.bootcdn.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load",()=>{window.cookieconsent.initialise({type:"info",theme:"block",static:!1,position:"bottom-right",content:{message:"此网站使用Cookie来改善您的体验。",dismiss:"知道了！",allow:"允许使用Cookie",deny:"拒绝",link:"了解更多",policy:"Cookie政策",href:"https://www.cookiesandyou.com/"},palette:{popup:{background:"#edeff5",text:"#838391"},button:{background:"#4b81e8"}}})})</script><script src="https://cdn.bootcdn.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdn.bootcdn.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load",()=>{"function"==typeof $.fn.lightGallery&&$(".article").lightGallery({selector:".gallery-item"}),"function"==typeof $.fn.justifiedGallery&&($(".justified-gallery > p > .gallery-item").length&&$(".justified-gallery > p > .gallery-item").unwrap(),$(".justified-gallery").justifiedGallery())})</script><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="War,war never changes..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){loadInsight({contentUrl:"/content.json"},{hint:"War,war never changes...",untitled:"(无标题)",posts:"文章",pages:"页面",categories:"分支",tags:"标签"})})</script>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,d=o();function o(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=o());for(var e,i=0;i<d.length;i++)0<=(e=(e=d[i]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,a,n,o=d[i];e=function(){d=d.filter(function(t){return o!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(o)},(t=o).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,n=t.getAttribute("data-original"),a.onload=function(){t.src=n,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=n},t.src!==n&&(a.src=n)))}()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)}(this);</script></body></html>